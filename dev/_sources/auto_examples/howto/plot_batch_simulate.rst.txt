
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/howto/plot_batch_simulate.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_howto_plot_batch_simulate.py>`
        to download the full example code. or to run this example in your browser via Binder

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_howto_plot_batch_simulate.py:


====================
07. Batch Simulation
====================

This example shows how to do batch simulations in HNN-core, allowing users to
efficiently run multiple simulations with different parameters
for comprehensive analysis.

.. GENERATED FROM PYTHON SOURCE LINES 10-16

.. code-block:: Python


    # Authors: Abdul Samad Siddiqui <abdulsamadsid1@gmail.com>
    #          Nick Tolley <nicholas_tolley@brown.edu>
    #          Ryan Thorpe <ryan_thorpe@brown.edu>
    #          Mainak Jas <mjas@mgh.harvard.edu>








.. GENERATED FROM PYTHON SOURCE LINES 17-18

Let us import ``hnn_core``.

.. GENERATED FROM PYTHON SOURCE LINES 18-26

.. code-block:: Python


    import matplotlib.pyplot as plt
    import numpy as np
    from hnn_core.batch_simulate import BatchSimulate
    from hnn_core import jones_2009_model

    # The number of cores may need modifying depending on your current machine.
    n_jobs = 10







.. GENERATED FROM PYTHON SOURCE LINES 27-60

.. code-block:: Python



    def set_params(param_values, net=None):
        """
        Set parameters in the network drives.

        Parameters
        ----------
        param_values : dict
            Dictionary of parameter values.
        net : instance of Network, optional
            If None, a new network is created using the specified model type.
        """
        if net is None:
            net = jones_2009_model()

        weights_ampa = {'L2_basket': param_values['weight_basket'],
                        'L2_pyramidal': param_values['weight_pyr'],
                        'L5_basket': param_values['weight_basket'],
                        'L5_pyramidal': param_values['weight_pyr']}

        synaptic_delays = {'L2_basket': 0.1, 'L2_pyramidal': 0.1,
                           'L5_basket': 1., 'L5_pyramidal': 1.}

        # Add an evoked drive to the network.
        net.add_evoked_drive('evprox',
                             mu=40,
                             sigma=5,
                             numspikes=1,
                             location='proximal',
                             weights_ampa=weights_ampa,
                             synaptic_delays=synaptic_delays)








.. GENERATED FROM PYTHON SOURCE LINES 61-62

Define a parameter grid for the batch simulation.

.. GENERATED FROM PYTHON SOURCE LINES 62-69

.. code-block:: Python



    param_grid = {
        'weight_basket': np.logspace(-4 - 1, 5),
        'weight_pyr': np.logspace(-4, -1, 5)
    }








.. GENERATED FROM PYTHON SOURCE LINES 70-71

Define a function to calculate summary statistics

.. GENERATED FROM PYTHON SOURCE LINES 71-95

.. code-block:: Python



    def summary_func(results):
        """
        Calculate the min and max dipole peak for each simulation result.

        Parameters
        ----------
        results : list
            List of dictionaries containing simulation results.

        Returns
        -------
        summary_stats : list
            Summary statistics for each simulation result.
        """
        summary_stats = []
        for result in results:
            dpl_data = result['dpl'][0].data['agg']
            min_peak = np.min(dpl_data)
            max_peak = np.max(dpl_data)
            summary_stats.append({'min_peak': min_peak, 'max_peak': max_peak})
        return summary_stats








.. GENERATED FROM PYTHON SOURCE LINES 96-97

Run the batch simulation and collect the results.

.. GENERATED FROM PYTHON SOURCE LINES 97-112

.. code-block:: Python


    # Comment off this code, if dask and distributed Python packages are installed
    # from dask.distributed import Client
    # client = Client(threads_per_worker=1, n_workers=5, processes=False)


    # Run the batch simulation and collect the results.
    batch_simulation = BatchSimulate(set_params=set_params,
                                     summary_func=summary_func)
    simulation_results = batch_simulation.run(param_grid,
                                              n_jobs=n_jobs,
                                              combinations=False,
                                              backend='multiprocessing')
    # backend='dask' if installed
    print("Simulation results:", simulation_results)




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [Parallel(n_jobs=10)]: Using backend MultiprocessingBackend with 10 concurrent workers.
    [Parallel(n_jobs=10)]: Done   1 tasks      | elapsed:   28.8s
    [Parallel(n_jobs=10)]: Using backend MultiprocessingBackend with 10 concurrent workers.
    [Parallel(n_jobs=10)]: Done   1 tasks      | elapsed:   28.3s
    [Parallel(n_jobs=10)]: Using backend MultiprocessingBackend with 10 concurrent workers.
    [Parallel(n_jobs=10)]: Done   1 tasks      | elapsed:   29.6s
    [Parallel(n_jobs=10)]: Using backend MultiprocessingBackend with 10 concurrent workers.
    [Parallel(n_jobs=10)]: Done   1 tasks      | elapsed:   28.3s
    [Parallel(n_jobs=10)]: Using backend MultiprocessingBackend with 10 concurrent workers.
    [Parallel(n_jobs=10)]: Done   1 tasks      | elapsed:   28.7s
    Simulation results: [[{'min_peak': -0.001242556683917088, 'max_peak': 0.004900589999999999}], [{'min_peak': -0.001242556683917088, 'max_peak': 0.004900589999999999}], [{'min_peak': -0.03665290820701789, 'max_peak': 0.02352069470140582}], [{'min_peak': -0.038695414756536456, 'max_peak': 0.022995093327209466}], [{'min_peak': -0.03373821891133495, 'max_peak': 0.03047248131934011}]]




.. GENERATED FROM PYTHON SOURCE LINES 113-115

Extract and Plot Results
##############################################################################

.. GENERATED FROM PYTHON SOURCE LINES 115-134

.. code-block:: Python


    # Extract min and max peaks for plotting
    min_peaks, max_peaks = [], []
    for res in simulation_results:
        summary_stats = res[0]
        min_peaks.append(summary_stats['min_peak'])
        max_peaks.append(summary_stats['max_peak'])

    # Plotting
    plt.figure(figsize=(10, 6))
    plt.plot(min_peaks, label='Min Dipole Peak')
    plt.plot(max_peaks, label='Max Dipole Peak')
    plt.xlabel('Simulation Index')
    plt.ylabel('Dipole Peak Magnitude')
    plt.title('Min and Max Dipole Peaks across Simulations')
    plt.legend()
    plt.grid(True)
    plt.tight_layout()
    plt.show()



.. image-sg:: /auto_examples/howto/images/sphx_glr_plot_batch_simulate_001.png
   :alt: Min and Max Dipole Peaks across Simulations
   :srcset: /auto_examples/howto/images/sphx_glr_plot_batch_simulate_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (2 minutes 23.987 seconds)


.. _sphx_glr_download_auto_examples_howto_plot_batch_simulate.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: binder-badge

      .. image:: images/binder_badge_logo.svg
        :target: https://mybinder.org/v2/gh/jonescompneurolab/hnn-core/gh-pages?filepath=dev/notebooks/auto_examples/howto/plot_batch_simulate.ipynb
        :alt: Launch binder
        :width: 150 px

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_batch_simulate.ipynb <plot_batch_simulate.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_batch_simulate.py <plot_batch_simulate.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_batch_simulate.zip <plot_batch_simulate.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
